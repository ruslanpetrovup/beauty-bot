# Telegram Бот для Записи к Мастерам

## Содержание

- [Общее описание](#общее-описание)
- [Структура проекта](#структура-проекта)
- [Сцены бота](#сцены-бота)
  - [Регистрация](#регистрация)
    - [Регистрация мастера](#регистрация-мастера)
    - [Регистрация клиента](#регистрация-клиента)
  - [Управление профилем](#управление-профилем)
    - [Профиль мастера](#профиль-мастера)
    - [Профиль клиента](#профиль-клиента)
  - [Управление услугами](#управление-услугами)
  - [Управление расписанием](#управление-расписанием)
  - [Бронирование](#бронирование)
  - [Рассылка](#рассылка)
- [Установка и запуск](#установка-и-запуск)

## Общее описание

Telegram бот для автоматизации записи клиентов к мастерам. Поддерживает регистрацию мастеров и клиентов, управление услугами, расписанием и записями.

## Структура проекта

src/  
├── bot/  
│   ├── scenes/  
│   │   ├── master/  
│   │   │   ├── broadcast.js  
│   │   │   ├── index.js  
│   │   │   ├── profileSettings.js  
│   │   │   ├── registration.js  
│   │   │   ├── schedule.js  
│   │   │   └── services.js  
│   │   └── client/  
│   │       ├── appointments.js  
│   │       ├── booking.js  
│   │       ├── index.js  
│   │       ├── profileSettings.js  
│   │       └── registration.js  
│   └── index.js  
├── db/  
│   ├── models/  
│   │   ├── appointment.js  
│   │   ├── client.js  
│   │   ├── index.js  
│   │   ├── master.js  
│   │   ├── schedule.js  
│   │   └── service.js  
│   └── index.js  
└── index.js  

## Сцены бота

### Регистрация

#### Регистрация мастера

**Файл:** `src/bot/scenes/master/registration.js`

**Описание:** Сцена регистрации нового мастера.

**Шаги:**

1. Проверка существующего пользователя
2. Ввод имени/названия салона
3. Ввод номера телефона
4. Ввод адреса (опционально)
5. Ввод описания услуг (опционально)

**Блок-схема:**

1. Проверка существующего пользователя
   - Да: Сообщение об ошибке
   - Нет: Переход к следующему шагу
2. Ввод имени/названия салона
   - Введено: Переход к следующему шагу
   - Не введено: Сообщение об ошибке
3. Ввод номера телефона
   - Введено: Переход к следующему шагу
   - Не введено: Сообщение об ошибке
4. Ввод адреса (опционально)
   - Введено: Переход к следующему шагу
   - Не введено: Переход к следующему шагу
5. Ввод описания услуг (опционально)
   - Введено: Завершение регистрации
   - Не введено: Завершение регистрации



**Команды:**

- `/start` - Начало регистрации
- Кнопка "Я мастер" в стартовом меню

#### Регистрация клиента

**Файл:** `src/bot/scenes/client/registration.js`

**Описание:** Сцена регистрации нового клиента.

**Шаги:**

1. Ввод имени
2. Ввод номера телефона
3. Подтверждение регистрации

**Блок-схема:**

1. Ввод имени
   - Введено: Переход к следующему шагу
   - Не введено: Сообщение об ошибке
2. Ввод номера телефона
   - Введено: Переход к следующему шагу
   - Не введено: Сообщение об ошибке
3. Подтверждение регистрации

**Команды:**

- `/start` - Начало регистрации
- Кнопка "Я клиент" в стартовом меню

### Управление профилем

#### Профиль мастера

**Файл:** `src/bot/scenes/master/profileSettings.js`

**Описание:** Управление профилем мастера.

**Функционал:**

- Просмотр текущих данных
- Редактирование имени
- Редактирование телефона
- Редактирование адреса
- Редактирование описания
- Управление статусом активности
- Настройка реквизитов оплаты

**Блок-схема:**

1. Просмотр текущих данных
   - Данные отображены: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
2. Редактирование имени
   - Имя изменено: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
3. Редактирование телефона
   - Телефон изменен: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
4. Редактирование адреса
   - Адрес изменен: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
5. Редактирование описания
   - Описание изменено: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
6. Управление статусом активности
   - Статус изменен: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
7. Настройка реквизитов оплаты
   - Реквизиты настроены: Завершение
   - Ошибка: Сообщение об ошибке


#### Профиль клиента

**Файл:** `src/bot/scenes/client/profileSettings.js`

**Описание:** Управление профилем клиента.

**Функционал:**

- Просмотр текущих данных
- Редактирование имени
- Редактирование телефона
- Удаление профиля

**Блок-схема:**

1. Просмотр текущих данных
   - Данные отображены: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
2. Редактирование имени
   - Имя изменено: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
3. Редактирование телефона
   - Телефон изменен: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
4. Удаление профиля
   - Проверка на наличие активных записей
     - Активные записи найдены: Сообщение об ошибке
     - Активные записи не найдены: Установка флага isActive в false и завершение
   - Ошибка: Сообщение об ошибке

**Особенности:**

- Проверка на наличие активных записей перед удалением
- Soft delete (установка флага isActive)

### Управление услугами

**Файл:** `src/bot/scenes/master/services.js`

**Описание:** Управление услугами мастера.

**Функционал:**

- Добавление новой услуги
- Редактирование существующих услуг
- Удаление услуг
- Установка цены
- Установка длительности
- Управление статусом активности услуги

### Управление расписанием

**Файл:** `src/bot/scenes/master/schedule.js`

**Описание:** Управление расписанием работы мастера.

**Функционал:**

- Добавление рабочих часов
- Установка перерывов
- Блокировка времени
- Просмотр расписания по дням
- Управление выходными днями

**Блок-схема:**

1. Добавление рабочих часов
   - Часы добавлены: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
2. Установка перерывов
   - Перерывы установлены: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
3. Блокировка времени
   - Время заблокировано: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
4. Просмотр расписания по дням
   - Расписание отображено: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
5. Управление выходными днями
   - Выходные дни установлены: Завершение
   - Ошибка: Сообщение об ошибке


### Бронирование

**Файл:** `src/bot/scenes/client/booking.js`

**Описание:** Процесс записи клиента к мастеру.

**Шаги:**

1. Выбор мастера
2. Выбор услуги
3. Выбор даты
4. Выбор времени
5. Подтверждение записи

### Рассылка

**Файл:** `src/bot/scenes/master/broadcast.js`

**Описание:** Отправка рассылок клиентам.

**Функционал:**

- Рассылка всем клиентам
- Рассылка клиентам с активными записями
- Настройка текста сообщения
- Просмотр статистики отправки

**Блок-схема:**

1. Настройка текста сообщения
   - Текст настроен: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
2. Выбор получателей
   - Все клиенты: Переход к следующему шагу
   - Клиенты с активными записями: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
3. Отправка рассылки
   - Рассылка отправлена: Переход к следующему шагу
   - Ошибка: Сообщение об ошибке
4. Просмотр статистики отправки
   - Статистика отображена: Завершение
   - Ошибка: Сообщение об ошибке

## Установка и запуск

1. Установка зависимостей:
   npm install

2. Настройка базы данных:

- Создать файл .env и заполнить данные
  BOT_TOKEN=your_telegram_bot_token
  DB_NAME=your_database_name
  DB_USER=your_database_user
  DB_PASSWORD=your_database_password
  DB_HOST=localhost
  DB_PORT=5432

- Создать базу данных и настроить подключение в файле db/index.js

npm run migrate

3. Запуск бота:
   npm start
